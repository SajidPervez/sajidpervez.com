---
import { Image } from 'astro:assets';
import { getCollection } from "astro:content";

const blogPosts = await getCollection("blog");
const postsPerPage = 4;

// Get current page from URL parameter or default to 1
const currentPage = Astro.url.searchParams.get('page') ? parseInt(Astro.url.searchParams.get('page')) : 1;

// Filter and sort posts
const publishedPosts = blogPosts
  .filter((post) => post.data.isDraft === false)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Calculate total pages
const totalPages = Math.ceil(publishedPosts.length / postsPerPage);

// Get posts for current page
const currentPosts = publishedPosts.slice(
  (currentPage - 1) * postsPerPage,
  currentPage * postsPerPage
);
---

<div class="flex flex-col gap-4">
  <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 mt-4 mb-4">
    {currentPosts.map((post) => (
      <div class="blog-card bg-white rounded-lg shadow-lg overflow-hidden ">
        <div class="blog-cover-container">
          <img 
            src={post.data.cover.src} 
            alt={post.data.cover.alt} 
            class="blog-cover" 
          />
        </div>
        <div class="p-4">
          <h2 class="text-l font-bold mb-2">
            <a href={`/blog/${post.slug}`} class="block hover:text-orange-700 no-underline">
              {post.data.title}
            </a>
          </h2>
          <span>
            <h5 class="font-medium text-gray-700">{post.data.author}</h5>
            <p class="text-gray-500 text-sm">{post.data.pubDate.toDateString()}</p>
          </span>
        </div>
      </div>
    ))}
  </div>

  <!-- Pagination Controls -->
  <div class="flex justify-center gap-2 my-4">
    {currentPage > 1 && (
      <a
        href={`?page=${currentPage - 1}`}
        class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300"
      >
        Previous
      </a>
    )}
    
    <span class="px-4 py-2">
      Page {currentPage} of {totalPages}
    </span>
    
    {currentPage < totalPages && (
      <a
        href={`?page=${currentPage + 1}`}
        class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300"
      >
        Next
      </a>
    )}
  </div>
</div>
