---
// Import necessary components
import BaseLayout from "./BaseLayout.astro";
import Prose from "../components/Prose.astro";
import TOC from '../components/TOC.astro';

// Extract the props
const { frontmatter, content: { title }, headings, Content } = Astro.props;
---

<BaseLayout pageTitle={frontmatter.pageTitle}>
  <header>
    <h1 class="text-3xl font-bold">{frontmatter.title}</h1>
    <p class="text-gray-500">
      By {frontmatter.author} on {frontmatter.pubDate.toString()}
    </p>
    <div class="tags">
      {frontmatter.tags.map((tag) => (
        <p class="tag">
          <a href={`/tags/${tag}`}>{tag}</a>
        </p>
      ))}
    </div>
    
  </header>

  <!-- Create a responsive grid layout -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Content Area -->
    <div class="col-span-2">
      <Prose>
        <slot />
      </Prose>
    </div>

    <!-- TOC for large screens, top for small screens -->
    {headings && headings.length > 0 && (
      <nav class="article-toc hidden lg:block lg:sticky lg:top-4">
        <h2>Table of Content</h2>
        <TOC headings={headings} />
      </nav>
    )}
  </div>
</BaseLayout>


 <script>

  addIntersectionObserver();
  
  function addIntersectionObserver() {
    const observer = new IntersectionObserver((sections) => {
      console.log('sections', sections);
      sections.forEach((section) => {
        const heading = section.target.querySelector('h2, h3, h4, h5');
        if (!heading) return;
        const id = heading.getAttribute('id');
  
        // Get the link to this section's heading
        const link = document.querySelector(`nav.toc li a[href="#${id}"]`);
        if (!link) return;
  
        // Add/remove the .active class based on whether the
        // section is visible
        const addRemove = section.intersectionRatio > 0 ? 'add' : 'remove';
        link.classList[addRemove]('active');
      });
    });
  
    document.querySelectorAll('.article-content section').forEach((section) => {
      observer.observe(section);
    })
  }
  </script>
 